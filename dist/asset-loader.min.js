/*!
 * asset-loader.js 0.0.1
 * https://github.com/Tom32i/asset-loader.js
 * Copyright 2014 Thomas JARRAND
 */

function Asset(t,e){this.element=new Image,this.source=t,this.element.asset=this,this.element.addEventListener("load",e)}function AssetCanvas(t,e){this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.element.width=t,this.element.height=e}function SoundAsset(t,e,s){this.source=t,this.element=new Audio,this.formats="undefined"!=typeof s?s:this.formats,this.element.asset=this,this.element.addEventListener("canplaythrough",e),this.attachSources()}function SpriteAsset(t,e,s,i){this.source=t,this.columns=e,this.rows=s,this.callback=i,this.length=e*s,this.width=0,this.height=0,this.images=[],this.assets=[],this.loaded=0,this.total=0,this.createImages()}Asset.prototype.setSource=function(t){this.source=t},Asset.prototype.load=function(){this.element.src=this.source},Asset.prototype.getImage=function(){return this.element},Asset.prototype.getWidth=function(){return this.element.width},Asset.prototype.getHeight=function(){return this.element.height},AssetCanvas.prototype.clear=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},AssetCanvas.prototype.toString=function(){return this.element.toDataURL()},AssetCanvas.prototype.drawImageFromSource=function(t,e,s){var i=this.element.width,o=this.element.height;this.context.drawImage(t,e,s,i,o,0,0,i,o)},SoundAsset.prototype.formats={mp3:"audio/mpeg",ogg:"audio/ogg"},SoundAsset.prototype.attachSources=function(){for(var t in this.formats){var e=document.createElement("source");e.type=this.formats[t],this.element.appendChild(e)}},SoundAsset.prototype.load=function(){document.body.appendChild(this.element);var t=0;for(var e in this.formats)this.element.childNodes[t].src=this.source+"."+e,t++},SoundAsset.prototype.getAudio=function(){return this.element},SpriteAsset.prototype.load=function(){var t=new Asset(this.source,this.preLoaded.bind(this));this.source=t.getImage(),t.load()},SpriteAsset.prototype.createImages=function(){for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++){var s=new Asset(null,this.callback);this.assets.push({asset:s,row:t,col:e}),this.images.push(s.getImage())}},SpriteAsset.prototype.preLoaded=function(){this.width=this.source.width/this.columns,this.height=this.source.height/this.rows,this.canvas=new AssetCanvas(this.width,this.height);var t,e,s,i,o;for(t=this.assets.length-1;t>=0;t--)e=this.assets[t],s=e.asset,i=e.col*this.width,o=e.row*this.height,this.canvas.clear(),this.canvas.drawImageFullFrom(this.source,i,o),s.setSource(this.canvas.toString()),s.load();delete this.canvas},SpriteAsset.prototype.getImages=function(){return this.images};